- name: Deploy Pro-vertos using Docker
  hosts: local
  tasks:
    - name: ðŸ§¹ Stop old backend container if running
      command: docker stop provertos_backend
      ignore_errors: yes

    - name: ðŸ”„ Remove old backend container
      command: docker rm provertos_backend
      ignore_errors: yes

    - name: ðŸ§± Build backend Docker image
      command: docker build -t provertos_backend:latest ../../backend

    - name: ðŸš€ Run backend container
      command: docker run -d --name provertos_backend -p 5000:5000 -e MONGO_URL={{ lookup('env', 'MONGO_URL') }} provertos_backend:latest

    - name: ðŸ§¹ Stop old frontend container if running
      command: docker stop provertos_frontend
      ignore_errors: yes

    - name: ðŸ”„ Remove old frontend container
      command: docker rm provertos_frontend
      ignore_errors: yes

    - name: ðŸ§± Build frontend Docker image
      command: docker build -t provertos_frontend:latest ../../frontend

    - name: ðŸš€ Run frontend container
      command: docker run -d --name provertos_frontend -p 3000:3000 provertos_frontend:latest
