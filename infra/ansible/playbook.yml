- name: Deploy Pro-vertos using Docker
  hosts: local
  tasks:
    - name: ğŸ§¹ Stop old backend container if running
      command: docker stop pro_backend
      ignore_errors: yes

    - name: ğŸ”„ Remove old backend container
      command: docker rm pro_backend
      ignore_errors: yes

    - name: ğŸ§± Build backend Docker image
      command: docker build -t pro_backend:latest ../../backend

    - name: ğŸš€ Run backend container
      command: docker run -d --name pro_backend -p 5000:5000 -e MONGO_URI={{ lookup('env', 'MONGO_URI') }} pro_backend:latest

    - name: ğŸ§¹ Stop old frontend container if running
      command: docker stop pro_frontend
      ignore_errors: yes

    - name: ğŸ”„ Remove old frontend container
      command: docker rm pro_frontend
      ignore_errors: yes

    - name: ğŸ§± Build frontend Docker image
      command: docker build -t pro_frontend:latest ../../frontend

    - name: ğŸš€ Run frontend container
      command: docker run -d --name pro_frontend -p 3000:3000 pro_frontend:latest
